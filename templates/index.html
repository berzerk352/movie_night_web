{% extends "base.html" %}

{% block title %}Movie Night Roll - Home{% endblock %}

{% block content %}
<div class="roll-container">
    <h1>ðŸŽ² Roll for Tonight's Movie</h1>
    
    {% if latest_roll %}
    <div class="current-movie">
        <h2>ðŸŽ¬ Current Movie</h2>
        <div class="current-movie-content">
            {% if latest_roll.tmdb_data and latest_roll.tmdb_data.poster_url %}
            <div class="current-movie-poster">
                <img src="{{ latest_roll.tmdb_data.poster_url }}" alt="{{ latest_roll.movie_title }} poster">
            </div>
            {% endif %}
            <div class="current-movie-info">
                <h3 class="current-movie-title">{{ latest_roll.movie_title }}</h3>
                <p class="current-movie-submitter">
                    <span class="submitter-label">Submitted by:</span>
                    <span class="submitter-name">{{ latest_roll.participant.name }}</span>
                </p>
                {% if latest_roll.tmdb_data %}
                <div class="current-movie-details">
                    {% if latest_roll.tmdb_data.release_date %}
                    <p><strong>Release Date:</strong> {{ latest_roll.tmdb_data.release_date }}</p>
                    {% endif %}
                    {% if latest_roll.tmdb_data.runtime %}
                    <p><strong>Runtime:</strong> {{ latest_roll.tmdb_data.runtime }} minutes</p>
                    {% endif %}
                    {% if latest_roll.tmdb_data.genres %}
                    <p><strong>Genres:</strong> {{ latest_roll.tmdb_data.genres|join(', ') }}</p>
                    {% endif %}
                    {% if latest_roll.tmdb_data.vote_average %}
                    <p><strong>Rating:</strong> {{ latest_roll.tmdb_data.vote_average }}/10</p>
                    {% endif %}
                    {% if latest_roll.tmdb_data.overview %}
                    <p class="current-movie-overview"><strong>Overview:</strong> {{ latest_roll.tmdb_data.overview }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="season-info" id="seasonInfo">
        <p>Loading season information...</p>
    </div>

    <div class="eligible-info" id="eligibleInfo">
        <h3>Eligible Participants</h3>
        <p>Loading...</p>
    </div>

    <div class="roll-options">
        <h3>Roll Options</h3>
        
        <div class="option-group">
            <label>
                <input type="radio" name="rollType" value="all" checked>
                Roll from all eligible participants
            </label>
        </div>
        
        <div class="option-group">
            <label>
                <input type="radio" name="rollType" value="custom">
                Roll from specific participants
            </label>
            <div id="customParticipants" class="custom-participants" style="display: none;">
                <p>Select participants:</p>
                <div id="participantCheckboxes"></div>
            </div>
        </div>
    </div>

    <button id="rollButton" class="btn btn-primary btn-large">
        ðŸŽ¬ Roll the Dice!
    </button>

    <div id="rollResult" class="roll-result" style="display: none;">
        <h2>ðŸŽ‰ Tonight's Selection</h2>
        <div class="result-content">
            <p class="participant-name"></p>
            <p class="movie-title"></p>
            <button id="enrichButton" class="btn btn-secondary">Fetch Movie Details from TMDB</button>
            <div id="movieDetails" class="movie-details" style="display: none;"></div>
        </div>
    </div>

    <div class="season-roster" id="seasonRoster">
        <h3>Already Selected This Season</h3>
        <ul id="rosterList"></ul>
        <button id="resetRosterButton" class="btn btn-danger btn-small">Reset Season Roster</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/roll.js') }}"></script>
{% endblock %}
